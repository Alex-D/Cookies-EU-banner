---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Demo — Cookies EU banner">
	<div id="cookies-eu-banner" style="display: none;">
		<span>This is a very basic example of a cookie banner message.</span>
		<a href="/demo/read-more" id="cookies-eu-more">Read more</a>
		<button id="cookies-eu-reject">Reject</button>
		<button id="cookies-eu-accept">Accept</button>
	</div>

	<main>
		<h1 class="title">Cookies EU banner</h1>
		<h2 class="subtitle-tag">Demo</h2>
		<ul class="links">
			<li><a href="../">Back to website</a></li>
			<li><a href="https://github.com/Alex-D/Cookies-EU-Banner">Cookies EU Banner on GitHub</a></li>
		</ul>

		<p>
			<em>DoNotTrack</em> is currently <strong id="dnt-state"></strong>
		</p>

		<section class="demo-box">
			<p>
				Current consent state <br>
				<span id="cookies-eu-state"></span>
			</p>
			<div class="demo-box__buttons">
				<button id="custom-accept">Accept</button>
				<button id="custom-reject">Reject</button>
				<div class="break"/>
				<button id="custom-reset">Reset</button>
			</div>
		</section>

		<p>
			You can do some custom buttons to accept/reject anywhere with some JS (see in script tag at the bottom).
		</p>
	</main>
</Layout>

<style>
	body {
		text-align: center;
	}

	a {
		color: #fff7ed;
		padding: 3px 0;
		text-underline-offset: 2px;
	}

	.gggrainy-svg {
		display: none;
	}

	main {
		margin: 100px auto;
		padding: 0 30px;
		max-width: 900px;
	}

	#cookies-eu-banner {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		display: flex;
		max-width: 800px;
		background: #92400e;
		color: #fef3c7;
		margin: 12px auto;
		padding: 6px;
		font-size: 16px;
		text-align: center;
		border-radius: 12px;
		box-shadow: 6px 0 12px #7c2d12, 0 0 4px #7c2d12;
		transform: translateY(0);
		transition: transform 500ms;
		animation: bannerIn 200ms;
	}

	@keyframes bannerIn {
		from {
			transform: translateY(-200%);
		}
		to {
			transform: translateY(0);
		}
	}

	#cookies-eu-banner.cookies-eu-banner--before-remove {
		transform: translateY(-200%);
	}

	#cookies-eu-banner span {
		padding: 8px 8px 8px 16px;
	}

	#cookies-eu-accept,
	#cookies-eu-reject {
		text-decoration: none;
		border: 0;
		border-bottom: 2px solid;
		border-radius: 6px;
		cursor: pointer;
		padding: 6px 16px 4px;
		margin: 2px 3px;
		font-size: 16px;
		transition: background 150ms, transform 150ms;
	}

	#cookies-eu-accept:active,
	#cookies-eu-reject:active {
		transform: translateY(2px);
		transition: transform 0ms;
	}

	#cookies-eu-more {
		padding: 8px 0;
	}

	#cookies-eu-accept {
		color: #78350f;
		background: #fef3c7;
		border-color: #fcd34d;
	}

	#cookies-eu-accept:hover {
		background-color: #fff;
	}

	#cookies-eu-reject {
		margin-left: auto;
		color: #fef3c7;
		background: #78350f;
		border-color: #78350f;
	}

	#cookies-eu-reject:hover {
		background-color: #451a03;
	}

	.title {
		display: inline-block;
		font-weight: 700;
		margin-bottom: 0;
		font-size: 60px;
		background: #fffbeb linear-gradient(to bottom right, white, #fffbeb);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
	}

	.subtitle-tag {
		display: inline-block;
		padding: 6px 12px;
		font-size: 14px;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 1px;
		text-indent: 0.5px;
		color: #451a03;
		background: #fffbeb linear-gradient(to bottom right, #fffbeb, #fef3c7);
		border-radius: 6px;
		transform: translate(10px, -30px);
	}

	.links {
		line-height: 24px;
		text-align: center;
		padding: 0;
		list-style: none;
	}

	.demo-box {
		max-width: 300px;
		background: #431407;
		color: #431407;
		background: #fdba74 linear-gradient(to bottom right, #fed7aa, #fdba74);
		background: #fdba74;
		background-image: url('/images/grainy-background.svg'), linear-gradient(to bottom right, #fef3c7, #fdba74);
		background-size: auto auto;
		padding: 30px;
		margin: 30px auto;
		border-radius: 12px;
	}

	.demo-box p:first-child {
		margin-top: 0;
	}

	.demo-box__buttons {
		display: flex;
		flex-wrap: wrap;
		max-width: 400px;
		margin: 30px auto 0;
	}

	.demo-box__buttons button {
		flex-grow: 1;
		font-size: 16px;
		padding: 12px 24px 9px;
		background: #ddd;
		border: 0;
		border-bottom: 3px solid;
		border-radius: 6px;
		margin: 0 4px;
		transition: transform 150ms;
	}

	.demo-box__buttons .break {
		flex-basis: 100%;
		height: 6px;
	}

	#custom-accept {
		color: #365314;
		background: #ecfccb;
		border-color: #bef264;
	}

	#custom-reject {
		color: #450a0a;
		background: #fee2e2;
		border-color: #fca5a5;
	}

	#custom-reset {
		color: #451a03;
		background: #fef3c7;
		border-color: #fcd34d;
	}

	.demo-box__buttons button:hover {
		background: white !important;
	}

	.demo-box__buttons button:active {
		transform: translateY(2px);
		transition: transform 0ms;
	}

	#cookies-eu-state {
		display: block;
		height: 20px;
		text-indent: -6px;
		font-weight: bold;
		margin-top: 3px;
	}
</style>

<script>
	document.getElementById('dnt-state')!.innerText = navigator.doNotTrack === '1' ? 'enabled' : 'disabled'

	import { createCookiesBanner } from '../../../../dist/cookies-eu-banner'

	const consentCookieName = 'demoConsent'
	const cookiesBanner = createCookiesBanner(
		{
			bannerElement: document.getElementById('cookies-eu-banner')!,
			acceptButtonElement: document.getElementById('cookies-eu-accept')!,
			rejectButtonElement: document.getElementById('cookies-eu-reject')!,
			moreLinkElement: document.getElementById('cookies-eu-more')!,
		},
		{
			onAccept: () => {
				/*
				 * Example: your Google Analytics script

				(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

				ga('create', 'UA-XXXXXXXX-X', 'auto');
				ga('send', 'pageview');

				*/

				console.log("Create cookies!");
			},
		},
		{
			consentCookieName,
			delayBeforeRemoveInMilliseconds: 500,
		}
	);

	function updateCookiesEuState() {
		const hasConsent = cookiesBanner.hasConsent()
		let state = '❔ Nor accepted nor rejected';

		if (hasConsent === true) {
			state = '✅ Accepted';
		} else if (hasConsent === false) {
			state = '❌ Rejected';
		}

		document.getElementById('cookies-eu-state')!.innerText = state;
	}

	updateCookiesEuState();
	setInterval(updateCookiesEuState, 100);

	// Prefer use addEventListener
	// For demo purpose I will use the CookiesEuBanner internal method
	cookiesBanner.addClickListener(document.getElementById('custom-accept')!, function () {
		cookiesBanner.setConsent(true);
		cookiesBanner.remove();
		updateCookiesEuState();
	});
	cookiesBanner.addClickListener(document.getElementById('custom-reject')!, function () {
		cookiesBanner.setConsent(false);
		cookiesBanner.remove();
		updateCookiesEuState();
	});
	cookiesBanner.addClickListener(document.getElementById('custom-reset')!, function () {
		cookiesBanner.deleteCookie(consentCookieName);
		window.location.reload();
	});
</script>
